!function(e,n){"function"==typeof define&&define.amd?define(function(){return e.Fiji=n()}):"object"==typeof exports?module.exports=e.Fiji=n():e.Fiji=n()}(this,function(){"use strict";var e=window.localStorage,n=window.sessionStorage,t=864e5,o=2592e6,i="Fiji",r=!0,l=function s(l){if(!(this instanceof s))return new s(l);var u=Object.create(null,{ttl:{value:l&&"undefined"!=typeof l.ttl?l.ttl:t},longTtl:{value:l&&"undefined"!=typeof l.longTtl?l.longTtl:o},ns:{value:l&&"undefined"!=typeof l.ns?l.ns:i},debug:{value:l&&"undefined"!=typeof l.debug?!!l.debug:r}}),a={};u.debug&&(console.log("Cleaning localStorage and sessionStorage (for testing only)"),e.removeItem(u.ns),n.removeItem(u.ns));var d=function(e){return e&&e.hasOwnProperty("id")&&e.hasOwnProperty("value")&&e.hasOwnProperty("expires")&&e.hasOwnProperty("isLongTerm")&&"undefined"!=typeof e.id&&"undefined"!=typeof e.value&&"undefined"!=typeof e.expires&&"undefined"!=typeof e.isLongTerm},f=function(e,n){var t="object"==typeof n&&n.toDateString?n:new Date,o=e||u.ttl;return new Date(t.valueOf()+o)},c=function(e,n,t){var o="undefined"==typeof n?null:n,i=!!t;return{id:e,value:o,expires:f(t?u.ttl:u.longTtl),isLongTerm:i}},g=function(e){if(!e)return void(u.debug&&console.warn("Please provide a key"));var n=a[e];return d(n)?n:null},v=function(e){return d(e)?void(a[e.id]=e):void(u.debug&&console.warn("Item was not set or properly formed: ",e))},p=function(e){return e?void("undefined"!=typeof a[e]&&(a[e]=null,delete a[e])):void(u.debug&&console.warn("Please provide a key"))},m=function(t){if(!t)return void(u.debug&&console.warn("Please provide a key"));var o=a[t],i=d(o)&&o.isLongTerm?e:n,r=JSON.parse(i.getItem(u.ns));return r?o="undefined"==typeof r[t]?null:r[t]:null},b=function(t){if(!d(t))return void(u.debug&&console.warn("Item was not set or properly formed: ",t));var o=t.isLongTerm?e:n,i=JSON.parse(o.getItem(u.ns));i||(i={}),i[t.id]=t,o.setItem(u.ns,JSON.stringify(i))},w=function(t){if(!t)return void(u.debug&&console.warn("Please provide a key"));var o=a[t];if(!d(o))return void(u.debug&&console.warn("Item was not set or properly formed: ",o));var i=o.isLongTerm?e:n,r=JSON.parse(i.getItem(u.ns));r[o.id]=null,delete r[o.id],i.setItem(u.ns,JSON.stringify(r))},y=function(e){if(!e)return void(u.debug&&console.warn("Please provide an item"));var n=new Date;return new Date(e.expires.valueOf())<n};this.get=function(e){var n,t=new Date,o=g(e);return o?y(o)?(n=m(e),d(n)&&(o.value=n.value),o.expires=f(o.isLongTerm?u.ttl:u.longTtl),b(o),v(o),u.debug&&(console.log('Updated cache item because expired "'+e+'" ('+o.value+")"),console.table(a))):u.debug&&(console.log("No cache init or update required, our data is still fresh."),console.table(a)):(n=m(e),n||(n=c(e,null)),v(n),o=g(e),u.debug&&(console.log('Initialized new cache item because blank "'+e+'"'),console.table(a))),u.debug&&console.log("It is now "+t.toString()+" and _cache["+e+"] expires at ",o.expires.toString()),o.value},this.set=function(e,n,t){var o=new Date,i=g(e);i?(i.value=n,i.expires=f(i.isLongTerm?u.ttl:u.longTtl),u.debug&&(console.log('Updated existing cache item "'+e+'" ('+n+") : "+o.toString()),console.table(a))):(i=c(e,n,t),u.debug&&(console.log('Initialized new cache item because blank "'+e+'"'),console.table(a))),i.isLongTerm!==!!t&&(w(e),i.isLongTerm=t),b(i),v(i)},this.del=function(t,o){return!t&&o?(n.removeItem(u.ns),e.removeItem(u.ns),a=null,a={},void(u.debug&&console.log("Nuked the Fiji, kaboom!"))):(w(t),void p(t))},this.list=function(){for(var e={},n=Object.keys(a),t=0;t<n.length;t++)e[n[t]]=this.get(n[t]);return e}};return l});